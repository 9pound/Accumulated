# 概述

原理：把数据看成是持续变化和不断增长的流

初衷：kafka 是一个流平台，在这个平台上可以发布和订阅数据流，并把它们保存起来，进行处理，

特点

- 允许发布和订阅消息流
- 集群
- 可复制、持久化、
- 流式处理 
- 存储，并持续处理

应用场景：事件驱动的微服务消息总线，流式应用，大规模数据管道



发布与订阅消息系统

- 数据（消息）的发送者不会直接把消息发送给接受者，




流平台，而非单纯地消息系统



定义：kafka基于发布与订阅的消息系统





基本概念

消息：

- kafka 的数据单元被称为消息、可以把消息看成数据库里的一个数据行或一条记录
- 消息由字节数组组成，消息没有特别的格式或意义

流：

- 流是一组从生产者移动到消费者的数据
- 把主题的数据看成一个流，不管它有多少个分区，

键

- 消息有一个可选的元数据键
- 键也是一个字节数组，用来控制消息被写入不同的分区，相同键的消息总是被写到相同的分区上

批次：

- 批次就是一组消息，这些消息属于同一个主题和分区。
- 把消息分成批次传输可以减少网络开销

主题：

- 消息通过主题进行分类，相当于数据库中的表
- 一个主题可以横跨多个服务器

分区：

- 一个分区就是一个提交日志，主题可以被分为若干分区
- 消息以追加的方式写入分区、以先入先出的方式读取
- 无法在整个主题的范围内保证消息的顺序性，但可以保证在单个分区的顺序
- 分区实现数据冗余和伸缩性

生产者：创建消息



分区器：

- 分区器为键生成一个散列值，并将其映射到指定分区上。保证同一个键的消息会被写到同一个分区上（生产者可以自定义分区器）

消费者： 消费者读取消息

- 消费者订阅一个或多个主题，并按消息的生成顺序读取它们，

偏移量：

- 偏移量是一种元数据，
- 它是一个不断递增的整数值
- 在给定分区里每个消息的偏移量都是唯一的
- 消费者把每个分区最后读取的消息偏移量保存在zookeeper或kafka上，如果消费者关闭或重启，它的读取状态不会丢失。

消费群组：

- 消费者是消费群组的一部分，
- 会有一个或多个消费者共同读取一个主题，
- 群组保证每个分区只能被一个消费者使用
- 如果一个消费者失效，群组里的其他消费者可以接管失效消费者的工作。

broker：

- 一个独立的kafka服务器被称为broker，
- broker接收来自生产者的消息，为消息设置偏移量，并提交消息到磁盘保存
- 一个分区从属于一个broker，该broker称为分区首领，

分区复制

- 一个分区可以被分配给多个broker，
- 为分区提供了消息冗余

保留消息

保留消息策略：要么保留一段时间，要么保留到消息达到一定大小的字节数，当消息达到这些上限时，旧的消息就会过期删除，

主题可以配置自己的保留策略，



kafka 使用zookeeper保存集群的元数据信息，和消费者信息